#install
install.packages("dplyr")
install.packages("stringr")
install.packages("stringi")
install.packages("tidyverse")
install.packages("lubridate")

library('RSQLite')
db_path <- paste0(getwd(),'/data/')
db <- dbConnect(SQLite(), dbname=paste(db_path,"monrpt.db",sep=''));

SQL<- "SELECT *
       FROM 
          chemdata
       WHERE
          station_type='River/Stream' AND duplicate='0';"  
chem<-dbGetQuery(conn=db,SQL);

SQL<- "SELECT *
       FROM 
          mdl;"  
mdl<-dbGetQuery(conn=db,SQL);          
          
SQL<-"SELECT
        sites.sta_seq,
        sites.name,
        sites.ylat,
        sites.xlong,
        sites.sbasn,
        basin.major,
        basin.mbasn
      FROM 
        sites
      JOIN 
        basin
      ON
        sites.sbasn = basin.sbasn;"
sitesbasin<-dbGetQuery(conn=db,SQL)    

dbDisconnect(db);

chemMdl<-merge(chem1,mdl,by="chemparameter",all.x=TRUE)
chemMdl$valueMDL<-ifelse(is.na(chemMdl$value),chemMdl$MDL,chemMdl$value)

chem_basin<-merge(chem1,sitesbasin,by="sta_seq")
chem1<-chem[,c(1,3:6,11:12)]
parametername<-chem[4]  

#Parse chemparameter data:
--------------------
chemunique<-unique(chem$chemparameter)
ChemP <- data.frame(chemparameter=character(), 
                numsample=integer(), 
                stringsAsFactors=FALSE)


for (i in 1:length((chemunique))) {
  parameter.i<-chem_basin[chem_basin$chemparameter==chemunique[i]&chem_basin$duplicate==0,]
  print(parameter.i)
}
--------------------
chempara1<-ncol(data.frame(chem_basin$chemparameter))
Magnesium <-lapply(chemparameter, function(x) NULL)
Nitrite<-lapply(chemparameter, function(x) NULL)
Nitrate<-lapply(chemparameter, function(x) NULL)
Ammonia<-lapply(chemparameter, function(x) NULL)
Calcium<-lapply(chemparameter, function(x) NULL)
Hardness<-lapply(chemparameter, function(x) NULL)
Organic.Nitrogen<-lapply(chemparameter, function(x) NULL)
Ortho.Phosphate<-lapply(chemparameter, function(x) NULL)
pH<-lapply(chemparameter, function(x) NULL)
Total.Kjeldahl.Nitrogen<-lapply(chemparameter, function(x) NULL)
Total.Nitrogen<-lapply(chemparameter, function(x) NULL)
Total.Solids<-lapply(chemparameter, function(x) NULL)
Total.Suspended.Solids<-lapply(chemparameter, function(x) NULL)
Turbidity<-lapply(chemparameter, function(x) NULL)
Alkalinity<-lapply(chemparameter, function(x) NULL)
Total.Phosphorous<-lapply(chemparameter, function(x) NULL)
Chloride<-lapply(chemparameter, function(x) NULL)
Total.Organic.Carbon<-lapply(chemparameter, function(x) NULL)
Silica<-lapply(chemparameter, function(x) NULL)
Chlorophyll.a.Plankton<-lapply(chemparameter, function(x) NULL)
Nitrate.Nitrite<-lapply(chemparameter, function(x) NULL)

for (i in 1:length(chemunique)) {
  Magnesium[[i]] <- data.frame(chem_basin[chem_basin$chemparameter==chemunique[i]&chem_basin$duplicate==0,])

  numsample<- vector(mode = "numeric",length=length(chemunique))
  chemsampP<- data.frame(chemunique=character(),
                         numsample=integer(),
                         stringsAsFactors = FALSE)
  Chembind<-rbind(chemcount,chemsampP)
  print(Chembind)
}


#what chemical parameters were collected?
unique(chem$chemparameter)

#How many river and stream sites were samples from 2011 through 2015?
length(chem1$sta_seq)

#How many samples were collected for each chemical parameter at river/stream sites? 
length(Magnesium[[1]]$chemparameter)

length(Nitrate$value)
length(`Nitrate/Nitrite`$value)
length(Ammonia$value)
length(Calcium$value)
length(Hardness$value)
length(`Organic Nitrogen`$value)
length(`Ortho Phosphate`$value)
length(pH$value)
length(`Total Kjeldahl Nitrogen`$value)
length(`Total Nitrogen`$value)
length(`Total Solids`$value)
length(`Total Suspended Solids`$value)
length(Turbidity$value)
length(Alkalinity$value)
length(`Total Phosphorous`$value)
length(Chloride$value)
length(`Total Organic Carbon`$value)
length(Silica$value)
length(`Chlorophyll-a Plankton`$value)

#test 
--------
chemunique<-unique(chem$chemparameter)

for (n in 1:nrow(parametername)) {
    samplenum<-
    print(paste(chemparameter[n]))
}

for (i in 1:length(unique(chemunique))) {
  print(chemunique[i])
}

for (row in 1:nrow(chem_basin)) {
  chemparameter<- chem_basin[row, "Magnesium"]
  chemparameter<- chem_basin[row, "Magnesium"]
  chemparameter<-as.matrix(chemparameter)
  if(chem_basin==chemparameter) {
    print(paste("Magnesium", 
                "Nitrite","Nitrate","Ammonia","Calcium","Hardness"))
  }
}

--------
#Do all of the samples have the same unit of measure for each given parameter?
  unique(Magnesium[[1]]$uom)
  
  unique(Nitrate$uom)
  unique(`Nitrate/Nitrite`$uom)
  unique(Ammonia$uom)
  unique(Calcium$uom)
  unique(Hardness$uom)
  unique(`Organic Nitrogen`$uom)
  unique(`Ortho Phosphate`$uom)
  unique(pH$uom)
  unique(`Total Kjeldahl Nitrogen`$uom)
  unique(`Total Nitrogen`$uom)
  unique(`Total Solids`$uom)
  unique(`Total Suspended Solids`$uom)
  unique(Turbidity$uom)
  unique(Alkalinity$uom)
  unique(`Total Phosphorous`$uom)
  unique(Chloride$uom)
  unique(`Total Organic Carbon`$uom)
  unique(Silica$uom)
  unique(`Chlorophyll-a Plankton`$uom)

#How many river and stream samples were collected excluding duplicates?
length(chem1$station_type)
          
#How many river and stream samples (excluding duplicates) were collected in each year?
datesvec<-(chem$collect_date)
dates <- data.frame(dates, stringsAsFactors = FALSE)

dates %>% 
  separate(dates, c("month", "day", "year"), sep = "/")




chemdate1<-unique(dates$`collect_date`)

#How many sites were collected in more than one year? 

#What sites were collected in more than one year and how many years were collected?

#How many sites were collected in more than one year?

#what sites were collected in more than one year and how many years were collected?
